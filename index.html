<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>AlpineJS Currency Converter</title>
    <script src="https://unpkg.com/alpinejs" defer></script>
</head>
<body>
    <div x-data="currencyConverter()" x-init="init" class="container">
        <div class="form">
            <h1>Convertisseur de devises</h1>

            <!-- Montant à convertir -->
            <div>
                <label for="amount">Montant :</label><br>
                <input type="number" id="amount" x-model="amount" placeholder="Enter amount" @input="updateSavedCurrencies" />
            </div>

            <!-- Choisir la devise d'origine -->
            <div>
                <label for="fromCurrency">De :</label>
                <select id="fromCurrency" x-model="fromCurrency" @change="updateSavedCurrencies">
                    <option value disabled default>Choisissez une devise</option>
                    <template x-for="currency in currencies">
                        <option :value="currency.code" x-text="currency.name"></option>
                    </template>
                </select>
            </div>

            <!-- Choisir la devise cible -->
            <div>
                <label for="toCurrency">Vers :</label>
                <select id="toCurrency" x-model="toCurrency">
                    <option value disabled default>Choisissez une devise</option>
                    <template x-for="currency in currencies">
                        <option :value="currency.code" x-text="currency.name"></option>
                    </template>
                </select>
            </div>

            <!-- Ajouter la devise sauvegardée -->
            <button @click="addSavedCurrency">Convertir</button>
        </div>

        <!-- Liste des devises sauvegardées et conversion vers chacune -->
        <div class="saves">
            <h3>Devises sauvegardées</h3>
            <span x-show="savedCurrencies.length === 0"><em>Aucune devise sauvegardée</em></span>
            <span x-show="savedCurrencies.length > 0">
                <ul>
                    <template x-for="(savedCurrency, index) in savedCurrencies" :key="index">
                        <li>
                            <span x-text="savedCurrency.name"></span>
                            <button @click="removeSavedCurrency(index)">Supprimer</button>
                            <div x-text="`${amount} ${fromCurrency} = ${savedCurrency.convertedAmount} ${savedCurrency.code}`"></div>
                        </li>
                    </template>
                </ul>
            </span>
        </div>
    </div>

    <script>
        function currencyConverter() {
            return {
                amount: 1,
                currencies: [],
                savedCurrencies: [
                    { code: 'EUR', name: 'Euro (EUR)', convertedAmount: null },
                    { code: 'USD', name: 'US Dollar (USD)', convertedAmount: null },
                    { code: 'GBP', name: 'British Pound (GBP)', convertedAmount: null }
                ],
                convertedAmount: null,
                apiKey: 'YOUR_API_KEY', // Remplacez par votre clé API
                fromCurrency: 'EUR',
                toCurrency: '',

                async init() {
                    await this.getCurrencies();
                    await this.updateSavedCurrencies();
                },

                // Obtenir la liste des devises
                async getCurrencies() {
                    const response = await fetch(`https://v6.exchangerate-api.com/v6/${this.apiKey}/codes`);
                    const data = await response.json();
                    this.currencies = data.supported_codes.map(code => {
                        return { code: code[0], name: `${code[1]} (${code[0]})` };
                    });
                },

                // Ajouter une devise sauvegardée
                async addSavedCurrency() {
                    if (!this.savedCurrencies.some(currency => currency.code === this.toCurrency)) {
                        const response = await fetch(`https://v6.exchangerate-api.com/v6/${this.apiKey}/latest/${this.fromCurrency}`);
                        const data = await response.json();
                        const rate = data.conversion_rates[this.toCurrency];

                        this.savedCurrencies.push({
                            code: this.toCurrency,
                            name: this.currencies.find(currency => currency.code === this.toCurrency).name,
                            convertedAmount: (this.amount * rate).toFixed(2)
                        });
                    }
                },

                // Supprimer une devise sauvegardée
                removeSavedCurrency(index) {
                    this.savedCurrencies.splice(index, 1);
                },

                // Mettre à jour les conversions pour les devises sauvegardées
                async updateSavedCurrencies() {
                    if (this.savedCurrencies.length > 0) {
                        const response = await fetch(`https://v6.exchangerate-api.com/v6/${this.apiKey}/latest/${this.fromCurrency}`);
                        const data = await response.json();

                        this.savedCurrencies = this.savedCurrencies.map(savedCurrency => {
                            const rate = data.conversion_rates[savedCurrency.code];
                            return {
                                ...savedCurrency,
                                convertedAmount: (this.amount * rate).toFixed(2)
                            };
                        });
                    }
                }
            }
        }
    </script>
</body>
</html>
